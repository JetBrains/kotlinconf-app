buildscript {
    repositories {
        maven { url "https://plugins.gradle.org/m2/" }
        mavenCentral()
        mavenLocal()
    }
    dependencies {
        classpath 'com.github.jengelman.gradle.plugins:shadow:2.0.2'
    }
}

apply plugin: 'kotlin-platform-jvm'

apply plugin: 'application'
apply plugin: 'com.github.johnrengelman.shadow'

mainClassName = 'org.jetbrains.kotlinconf.backend.ServerKt'

sourceCompatibility = 1.8

dependencies {
    expectedBy project(":common")

    implementation "io.ktor:ktor-client-cio:$ktor_version"

    implementation "org.jetbrains.kotlin:kotlin-stdlib-jdk8:$kotlin_version"
    implementation "org.jetbrains.kotlin:kotlin-reflect:$kotlin_version"
    implementation "io.ktor:ktor-server-netty:$ktor_version"
    implementation "io.ktor:ktor-gson:$ktor_version"
    implementation "io.ktor:ktor-auth:$ktor_version"
    implementation "io.ktor:ktor-websockets:$ktor_version"
    implementation "io.ktor:ktor-client-apache:$ktor_version"
    implementation "org.jetbrains.squash:squash:$squash_version"
    implementation "org.jetbrains.squash:squash-h2:$squash_version"
    implementation 'com.github.salomonbrys.kotson:kotson:2.5.0'
    implementation group: 'com.zaxxer', name: 'HikariCP', version: '2.7.2'

    implementation 'ch.qos.logback:logback-classic:1.2.3'
    testImplementation group: 'junit', name: 'junit', version: '4.12'
}

compileKotlin.kotlinOptions.jvmTarget = '1.8'
compileTestKotlin.kotlinOptions.jvmTarget = '1.8'

sourceSets {
    main.java.srcDirs += 'src'
    main.resources.srcDirs += 'resources'
    main.kotlin.srcDirs += 'src'
    test.java.srcDirs += 'test'
    test.kotlin.srcDirs += 'test'
}

shadowJar {
    baseName = 'backend'
    classifier = null
    version = null
}

kotlin.experimental.coroutines 'enable'
